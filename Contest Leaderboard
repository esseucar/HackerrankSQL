SET NOCOUNT ON;
WITH max_scores_cte AS (
    SELECT 
        h.hacker_id, 
        h.name, 
        MAX(s.score) AS best_per_challenge
    FROM Hackers h
    JOIN Submissions s ON h.hacker_id = s.hacker_id
    GROUP BY h.hacker_id, h.name, s.challenge_id
)
SELECT 
    hacker_id, 
    name, 
    SUM(best_per_challenge) AS total_score
FROM max_scores_cte
GROUP BY hacker_id, name
HAVING SUM(best_per_challenge) > 0
ORDER BY SUM(best_per_challenge) DESC, hacker_id ASC;

go
